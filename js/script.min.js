"use strict";$(function(){const t="#F0F0F0",o="#D0D0D0",r="#505050",a="#A0A0A0",s=["#E1002A","#CB003B","#B4004D","#990062","#850072","#6D0084","#540098","#3D00AA","#2600BC","#0E00CF"],e=Object.freeze({TITLE:{getCaption:T,getTip:m},STATE:{getCaption:m,getTip:T}}),l=Object.freeze({TITLE:t=>t.title.sortable(),TITLE_LENGTH:t=>t.title.replaceAll(" ","").length,STATE:t=>t.state,YEAR:t=>t.year});let i,n={},c=[],p=[];var g;function d(){(i=new jvm.Map({map:"us_aea",container:$("#map"),backgroundColor:t,zoomMin:.9,focusOn:{x:.5,y:.5,scale:.95},series:{regions:[{attribute:"fill"}]},onRegionClick:(t,e)=>k(e),onRegionTipShow:(t,e,o)=>{o=n[o];o&&e.text(`${o.state}: ${o.title} (${o.year})`)}})).series.regions[0].setValues(function(){var t={};for(var e in i.regions)t[e]=n[e]?n[e].colour:o;return t}())}function f(){i&&(i.remove(),i=void 0)}function h(e,t,o){$(e).empty(),t.forEach(t=>$(e).append(u(t,o)))}function u(t,e){return $("<span></span>").addClass("filmButton").prop({title:e.getTip(t),style:"background-color: "+t.colour}).text(e.getCaption(t)).click(()=>k(t.stateCode)).prepend($("<img/>").prop({src:L(t),alt:S(t)}).on("error",function(){$(this).hide()}))}function m(t){return t.state}function T(t){return`${t.title} (${t.year})`}function b(t){$(t).addClass("selected").siblings().removeClass("selected")}function w(t){$(t).show().siblings().hide()}function k(t){t=n[t];t&&($("#filmState").text(t.state),$("#filmTitle").text(t.title),$("#filmYear").text(t.year),$("#filmStateFlag").prop({src:L(t),alt:S(t)}),$("#filmImageContainer").toggleClass("defaultImage",!t.image),$("#filmImage").prop({src:t.image,alt:`Movie poster for ${t.title} (${t.year})`}).toggle(!!t.image),$("#filmOriginalTitle").text(t.originalTitle).toggle(!!t.originalTitle),$("#imdbLink").toggle(!!t.imdb).prop({href:`https://www.imdb.com/title/${t.imdb}/`}),$("#letterboxdLink").toggle(!!t.letterboxd).prop({href:`https://letterboxd.com/film/${t.letterboxd}/`}),$("#rottenTomatoesLink").toggle(!!t.rottenTomatoes).prop({href:"https://www.rottentomatoes.com/m/"+t.rottenTomatoes}),$("#wikipediaLink").toggle(!!t.wikipedia).prop({href:"https://en.wikipedia.org/wiki/"+t.wikipedia}),$("#justwatchLink").toggle(!!t.justwatch).prop({href:"https://www.justwatch.com/uk/movie/"+t.justwatch}),$("#trailerLink").toggle(!!t.trailer).prop({href:"https://youtu.be/"+t.trailer}),$("#reviewLink").toggle(!!t.review).prop({href:"https://youtu.be/"+t.review}),$("#filmReviewer").text(t.reviewer),$(".modal-header").css("background-color",t.colour),$("#filmDetailsModal").modal())}function L(t){return"US-DC"===t.stateCode?"https://upload.wikimedia.org/wikipedia/commons/0/03/Flag_of_Washington%2C_D.C.svg":`https://flagcdn.com/${t.stateCode.toLowerCase()}.svg`}function S(t){return"State flag of "+t.state}$("a").not("#exorcist").prop("target","_blank"),$("a#exorcist").click(t=>{t.preventDefault(),k("US-DC")}),$("#btnShowMap").click(()=>{b("#btnShowMap"),w("#sectionMap"),d()}),$("#btnShowListStates").click(()=>{b("#btnShowListStates"),w("#sectionListStates"),f()}),$("#btnShowListMovies").click(()=>{b("#btnShowListMovies"),w("#sectionListMovies"),f()}),$("#btnShowAbout").click(()=>{b("#btnShowAbout"),w("#sectionAbout"),f()}),$("#filmStateFlag").on({error:function(){$(this).hide()},load:function(){$(this).show()}}),g=()=>{$("#filmCount").text(c.length),d(),h("#listStates",c,e.STATE),h("#listMovies",p,e.TITLE);{let e={};c.forEach(t=>{t=t.year.toString().slice(0,3)+"0s";e[t]=(e[t]||0)+1});var t=Object.keys(e).sort(),o=t.map(t=>e[t]),i=$("#byDecade");new Chart(i,{type:"bar",options:{plugins:{legend:{display:!1}},borderWidth:1,scales:{x:{grid:{color:r},ticks:{color:a}},y:{grid:{color:r},ticks:{color:a}}}},data:{labels:t,datasets:[{label:"Total",fill:!0,data:o,backgroundColor:s.slice(0,t.length),borderColor:a,borderWidth:1}]}})}p.filter(t=>-1<t.title.indexOf(t.state)).forEach(t=>$("#stateInTitle").append(u(t,e.TITLE)));i=p.slice().sortBy(l.YEAR),$("#oldestNewest").append(u(i.shift(),e.TITLE),u(i.pop(),e.TITLE)),o=p.slice().sortBy(l.TITLE_LENGTH);$("#longestShortest").append(u(o.shift(),e.TITLE),u(o.pop(),e.TITLE))},c=[],p=[],n={},$.getJSON("data/films.json",t=>{t.forEach(t=>{var e;t.colour=(e=Math.floor(Math.random()*s.length),s[e]),n[t.stateCode]=t}),c=t.sortBy(l.STATE),p=t.slice().sortBy(l.TITLE),g()}),String.prototype.sortable=function(){return this.replace(/^(A|The) /,"")},Array.prototype.sortBy=function(o){return this.sort((t,e)=>o(t)<o(e)?-1:o(t)>o(e)?1:0)}});