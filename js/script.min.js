"use strict";$(function(){function t(){$("a").not("#exorcist").prop("target","_blank"),$("a#exorcist").click(function(t){t.preventDefault(),A("US-DC")}),$("#btnShowMap").click(function(){L()}),$("#btnShowListStates").click(function(){h()}),$("#btnShowListMovies").click(function(){m()}),$("#btnShowAbout").click(function(){E()}),$("#filmStateFlag").on({error:function(){$(this).hide()},load:function(){$(this).show()}})}function e(t){j=[],F=[],D={},$.getJSON("data/films.json",function(e){e.forEach(function(t){t.colour=S(),D[t.stateCode]=t}),j=e.sortBy(B.STATE),F=e.slice().sortBy(B.TITLE),t()})}function n(){M=new jvm.Map({map:"us_aea",container:$("#map"),backgroundColor:R,zoomMin:.9,focusOn:{x:.5,y:.5,scale:.95},series:{regions:[{attribute:"fill"}]},onRegionClick:function(t,e){A(e)},onRegionTipShow:function(t,e,n){let o=D[n];o&&e.text(`${o.state}: ${o.title} (${o.year})`)}}),M.series.regions[0].setValues(_())}function o(){M&&(M.remove(),M=void 0)}function i(){a("#listStates",j,v.STATE)}function r(){a("#listMovies",F,v.TITLE)}function a(t,e,n){$(t).empty(),e.forEach(function(e){$(t).append(c(e,n))})}function c(t,e){return $("<span></span>").addClass("filmButton").prop({title:e.getTip(t),style:`background-color: ${t.colour}`}).text(e.getCaption(t)).click(function(){A(t.stateCode)}).prepend($("<img/>").prop({src:C(t),alt:x.ALT_TEXT_FLAG(t.state)}).on("error",function(){$(this).hide()}))}function s(t){return t.state}function l(t){return`${t.title} (${t.year})`}function u(){$("#filmCount").text(j.length)}function f(){T(),p(),d(),g()}function T(){let t={};j.forEach(function(e){var n=e.year.toString().slice(0,3)+"0s";t[n]=(t[n]||0)+1});const e=Object.keys(t).sort(),n=e.map(e=>t[e]);let o=$("#byDecade");new Chart(o,{type:"bar",options:{plugins:{legend:{display:!1}},borderWidth:1,scales:{x:{grid:{color:I},ticks:{color:y}},y:{grid:{color:I},ticks:{color:y}}}},data:{labels:e,datasets:[{label:"Total",fill:!0,data:n,backgroundColor:O.slice(0,e.length),borderColor:y,borderWidth:1}]}})}function p(){F.filter(t=>t.title.indexOf(t.state)>-1).forEach(t=>$("#stateInTitle").append(c(t,v.TITLE)))}function d(){let t=F.slice().sortBy(B.YEAR);$("#oldestNewest").append(c(t.shift(),v.TITLE),c(t.pop(),v.TITLE))}function g(){let t=F.slice().sortBy(B.TITLE_LENGTH);$("#longestShortest").append(c(t.shift(),v.TITLE),c(t.pop(),v.TITLE))}function L(){w("#btnShowMap"),b("#sectionMap"),n()}function h(){w("#btnShowListStates"),b("#sectionListStates"),o()}function m(){w("#btnShowListMovies"),b("#sectionListMovies"),o()}function E(){w("#btnShowAbout"),b("#sectionAbout"),o()}function w(t){$(t).addClass("selected").siblings().removeClass("selected")}function b(t){$(t).show().siblings().hide()}function _(){let t={};for(let e in M.regions)t[e]=D[e]?D[e].colour:U;return t}function S(){let t=Math.floor(Math.random()*O.length);return O[t]}function A(t){let e=D[t];e&&($("#filmState").text(e.state),$("#filmTitle").text(e.title),$("#filmYear").text(e.year),$("#filmStateFlag").prop({src:C(e),alt:x.ALT_TEXT_FLAG(e.state)}),$("#filmImageContainer").toggleClass("defaultImage",!e.image),$("#filmImage").prop({src:e.image,alt:x.ALT_TEXT_POSTER(e.title)}).toggle(!!e.image),$("#filmOriginalTitle").text(e.originalTitle).toggle(!!e.originalTitle),k("#imdbLink",x.URL_IMDB,e.imdb),k("#letterboxdLink",x.URL_LETTERBOXD,e.letterboxd),k("#rottenTomatoesLink",x.URL_ROTTEN_TOMATOES,e.rottenTomatoes),k("#wikipediaLink",x.URL_WIKIPEDIA,e.wikipedia),k("#justwatchLink",x.URL_JUST_WATCH,e.justwatch),k("#trailerLink",x.URL_YOUTUBE,e.trailer),k("#reviewLink",x.URL_YOUTUBE,e.review),$("#filmReviewer").text(e.reviewer),$(".modal-header").css("background-color",e.colour),$("#filmDetailsModal").modal())}function k(t,e,n){$(t).prop({href:e(n)}).toggle(!!n)}function C(t){return"US-DC"===t.stateCode?"https://upload.wikimedia.org/wikipedia/commons/0/03/Flag_of_Washington%2C_D.C.svg":x.URL_FLAG(t.stateCode.toLowerCase())}const R="#f0f0f0",U="#d0d0d0",I="#505050",y="#a0a0a0",O=["#E1002A","#CB003B","#B4004D","#990062","#850072","#6D0084","#540098","#3D00AA","#2600BC","#0E00CF"],v=Object.freeze({TITLE:{getCaption:l,getTip:s},STATE:{getCaption:s,getTip:l}}),B=Object.freeze({TITLE:function(t){return t.title.sortable()},TITLE_LENGTH:function(t){return t.title.replaceAll(" ","").length},STATE:function(t){return t.state},YEAR:function(t){return t.year}}),x=Object.freeze({ALT_TEXT_FLAG:function(t){return`State flag of ${t}`},ALT_TEXT_POSTER:function(t){return`Poster for ${t}`},URL_FLAG:function(t){return`https://flagcdn.com/${t}.svg`},URL_IMDB:function(t){return`https://www.imdb.com/title/${t}/`},URL_JUST_WATCH:function(t){return`https://www.justwatch.com/uk/movie/${t}`},URL_LETTERBOXD:function(t){return`https://letterboxd.com/film/${t}/`},URL_ROTTEN_TOMATOES:function(t){return`https://www.rottentomatoes.com/m/${t}`},URL_WIKIPEDIA:function(t){return`https://en.wikipedia.org/wiki/${t}`},URL_YOUTUBE:function(t){return`https://www.youtube.com/watch?v=${t}`}});let M,D={},j=[],F=[];t(),e(function(){u(),n(),i(),r(),f()}),String.prototype.sortable=function(){return this.replace(/^(A|The) /,"")},Array.prototype.sortBy=function(t){return this.sort(function(e,n){return t(e)<t(n)?-1:t(e)>t(n)?1:0})}});