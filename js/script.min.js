"use strict";$(function(){const t="#F0F0F0",o="#D0D0D0",a="#505050",r="#A0A0A0",s=["#E1002A","#CB003B","#B4004D","#990062","#850072","#6D0084","#540098","#3D00AA","#2600BC","#0E00CF"],e=Object.freeze({TITLE:{getCaption:m,getTip:h},STATE:{getCaption:h,getTip:m}}),n=Object.freeze({TITLE:t=>t.title.sortable(),TITLE_LENGTH:t=>t.title.replaceAll(" ","").length,STATE:t=>t.state,YEAR:t=>t.year}),i=Object.freeze({ALT_TEXT_FLAG:t=>"State flag of "+t,ALT_TEXT_POSTER:t=>"Poster for "+t,URL_FLAG:t=>`https://flagcdn.com/${t}.svg`,URL_IMDB:t=>`https://www.imdb.com/title/${t}/`,URL_JUST_WATCH:t=>"https://www.justwatch.com/uk/movie/"+t,URL_LETTERBOXD:t=>`https://letterboxd.com/film/${t}/`,URL_ROTTEN_TOMATOES:t=>"https://www.rottentomatoes.com/m/"+t,URL_WIKIPEDIA:t=>"https://en.wikipedia.org/wiki/"+t,URL_YOUTUBE:t=>"https://www.youtube.com/watch?v="+t});let l,c={},T=[],p=[];var d;function g(){(l=new jvm.Map({map:"us_aea",container:$("#map"),backgroundColor:t,zoomMin:.9,focusOn:{x:.5,y:.5,scale:.95},series:{regions:[{attribute:"fill"}]},onRegionClick:(t,e)=>b(e),onRegionTipShow:(t,e,o)=>{o=c[o];o&&e.text(`${o.state}: ${o.title} (${o.year})`)}})).series.regions[0].setValues(function(){var t={};for(var e in l.regions)t[e]=c[e]?c[e].colour:o;return t}())}function f(){l&&(l.remove(),l=void 0)}function L(e,t,o){$(e).empty(),t.forEach(t=>$(e).append(u(t,o)))}function u(t,e){return $("<span></span>").addClass("filmButton").prop({title:e.getTip(t),style:"background-color: "+t.colour}).text(e.getCaption(t)).click(()=>b(t.stateCode)).prepend($("<img/>").prop({src:A(t),alt:i.ALT_TEXT_FLAG(t.state)}).on("error",function(){$(this).hide()}))}function h(t){return t.state}function m(t){return`${t.title} (${t.year})`}function E(t){$(t).addClass("selected").siblings().removeClass("selected")}function w(t){$(t).show().siblings().hide()}function b(t){t=c[t];t&&($("#filmState").text(t.state),$("#filmTitle").text(t.title),$("#filmYear").text(t.year),$("#filmStateFlag").prop({src:A(t),alt:i.ALT_TEXT_FLAG(t.state)}),$("#filmImageContainer").toggleClass("defaultImage",!t.image),$("#filmImage").prop({src:t.image,alt:i.ALT_TEXT_POSTER(t.title)}).toggle(!!t.image),$("#filmOriginalTitle").text(t.originalTitle).toggle(!!t.originalTitle),_("#imdbLink",i.URL_IMDB,t.imdb),_("#letterboxdLink",i.URL_LETTERBOXD,t.letterboxd),_("#rottenTomatoesLink",i.URL_ROTTEN_TOMATOES,t.rottenTomatoes),_("#wikipediaLink",i.URL_WIKIPEDIA,t.wikipedia),_("#justwatchLink",i.URL_JUST_WATCH,t.justwatch),_("#trailerLink",i.URL_YOUTUBE,t.trailer),_("#reviewLink",i.URL_YOUTUBE,t.review),$("#filmReviewer").text(t.reviewer),$(".modal-header").css("background-color",t.colour),$("#filmDetailsModal").modal())}function _(t,e,o){$(t).prop({href:e(o)}).toggle(!!o)}function A(t){return"US-DC"===t.stateCode?"https://upload.wikimedia.org/wikipedia/commons/0/03/Flag_of_Washington%2C_D.C.svg":i.URL_FLAG(t.stateCode.toLowerCase())}$("a").not("#exorcist").prop("target","_blank"),$("a#exorcist").click(t=>{t.preventDefault(),b("US-DC")}),$("#btnShowMap").click(()=>{E("#btnShowMap"),w("#sectionMap"),g()}),$("#btnShowListStates").click(()=>{E("#btnShowListStates"),w("#sectionListStates"),f()}),$("#btnShowListMovies").click(()=>{E("#btnShowListMovies"),w("#sectionListMovies"),f()}),$("#btnShowAbout").click(()=>{E("#btnShowAbout"),w("#sectionAbout"),f()}),$("#filmStateFlag").on({error:function(){$(this).hide()},load:function(){$(this).show()}}),d=()=>{$("#filmCount").text(T.length),g(),L("#listStates",T,e.STATE),L("#listMovies",p,e.TITLE);{let e={};T.forEach(t=>{t=t.year.toString().slice(0,3)+"0s";e[t]=(e[t]||0)+1});var t=Object.keys(e).sort(),o=t.map(t=>e[t]),i=$("#byDecade");new Chart(i,{type:"bar",options:{plugins:{legend:{display:!1}},borderWidth:1,scales:{x:{grid:{color:a},ticks:{color:r}},y:{grid:{color:a},ticks:{color:r}}}},data:{labels:t,datasets:[{label:"Total",fill:!0,data:o,backgroundColor:s.slice(0,t.length),borderColor:r,borderWidth:1}]}})}p.filter(t=>-1<t.title.indexOf(t.state)).forEach(t=>$("#stateInTitle").append(u(t,e.TITLE)));i=p.slice().sortBy(n.YEAR),$("#oldestNewest").append(u(i.shift(),e.TITLE),u(i.pop(),e.TITLE)),o=p.slice().sortBy(n.TITLE_LENGTH);$("#longestShortest").append(u(o.shift(),e.TITLE),u(o.pop(),e.TITLE))},T=[],p=[],c={},$.getJSON("data/films.json",t=>{t.forEach(t=>{var e;t.colour=(e=Math.floor(Math.random()*s.length),s[e]),c[t.stateCode]=t}),T=t.sortBy(n.STATE),p=t.slice().sortBy(n.TITLE),d()}),String.prototype.sortable=function(){return this.replace(/^(A|The) /,"")},Array.prototype.sortBy=function(o){return this.sort((t,e)=>o(t)<o(e)?-1:o(t)>o(e)?1:0)}});