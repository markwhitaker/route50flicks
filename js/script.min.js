"use strict";$((function(){const t=["#E1002A","#CB003B","#B4004D","#990062","#850072","#6D0084","#540098","#3D00AA","#2600BC","#0E00CF"],e=Object.freeze({TITLE:{getCaption:d,getTip:p},STATE:{getCaption:p,getTip:d}}),o=Object.freeze({TITLE:function(t){return t.title.sortable()},TITLE_LENGTH:function(t){return t.title.replaceAll(" ","").length},STATE:function(t){return t.state},YEAR:function(t){return t.year}}),i=Object.freeze({ALT_TEXT_FLAG:function(t){return`State flag of ${t}`},ALT_TEXT_POSTER:function(t){return`Poster for ${t}`},URL_FLAG:function(t){return`https://flagcdn.com/${t}.svg`},URL_IMDB:function(t){return`https://www.imdb.com/title/${t}/`},URL_JUST_WATCH:function(t){return`https://www.justwatch.com/uk/movie/${t}`},URL_LETTERBOXD:function(t){return`https://letterboxd.com/film/${t}/`},URL_ROTTEN_TOMATOES:function(t){return`https://www.rottentomatoes.com/m/${t}`},URL_WIKIPEDIA:function(t){return`https://en.wikipedia.org/wiki/${t}`},URL_YOUTUBE:function(t){return`https://www.youtube.com/watch?v=${t}`}});let n,r={},a=[],s=[];var l;function c(){n=new jvm.Map({map:"us_aea",container:$("#map"),backgroundColor:"#f0f0f0",zoomMin:.9,focusOn:{x:.5,y:.5,scale:.95},series:{regions:[{attribute:"fill"}]},onRegionClick:function(t,e){h(e)},onRegionTipShow:function(t,e,o){let i=r[o];i&&e.text(`${i.state}: ${i.title} (${i.year})`)}}),n.series.regions[0].setValues(function(){let t={};for(let e in n.regions)t[e]=r[e]?r[e].colour:"#d0d0d0";return t}())}function u(){n&&(n.remove(),n=void 0)}function f(t,e,o){$(t).empty(),e.forEach((function(e){$(t).append(T(e,o))}))}function T(t,e){return $("<span></span>").addClass("filmButton").prop({title:e.getTip(t),style:`background-color: ${t.colour}`}).text(e.getCaption(t)).click((function(){h(t.stateCode)})).prepend($("<img/>").prop({src:E(t),alt:i.ALT_TEXT_FLAG(t.state)}).on("error",(function(){$(this).hide()})))}function p(t){return t.state}function d(t){return`${t.title} (${t.year})`}function g(t){$(t).addClass("selected").siblings().removeClass("selected")}function L(t){$(t).show().siblings().hide()}function h(t){let e=r[t];e&&($("#filmState").text(e.state),$("#filmTitle").text(e.title),$("#filmYear").text(e.year),$("#filmStateFlag").prop({src:E(e),alt:i.ALT_TEXT_FLAG(e.state)}),$("#filmImageContainer").toggleClass("defaultImage",!e.image),$("#filmImage").prop({src:e.image,alt:i.ALT_TEXT_POSTER(e.title)}).toggle(!!e.image),$("#filmOriginalTitle").text(e.originalTitle).toggle(!!e.originalTitle),m("#imdbLink",i.URL_IMDB,e.imdb),m("#letterboxdLink",i.URL_LETTERBOXD,e.letterboxd),m("#rottenTomatoesLink",i.URL_ROTTEN_TOMATOES,e.rottenTomatoes),m("#wikipediaLink",i.URL_WIKIPEDIA,e.wikipedia),m("#justwatchLink",i.URL_JUST_WATCH,e.justwatch),m("#trailerLink",i.URL_YOUTUBE,e.trailer),m("#reviewLink",i.URL_YOUTUBE,e.review),$("#filmReviewer").text(e.reviewer),$(".modal-header").css("background-color",e.colour),$("#filmDetailsModal").modal())}function m(t,e,o){$(t).prop({href:e(o)}).toggle(!!o)}function E(t){return"US-DC"===t.stateCode?"https://upload.wikimedia.org/wikipedia/commons/d/d4/Flag_of_the_District_of_Columbia.svg":i.URL_FLAG(t.stateCode.toLowerCase())}$("a").not("#exorcist").prop("target","_blank"),$("a#exorcist").click((function(t){t.preventDefault(),h("US-DC")})),$("#btnShowMap").click((function(){g("#btnShowMap"),L("#sectionMap"),c()})),$("#btnShowListStates").click((function(){g("#btnShowListStates"),L("#sectionListStates"),u()})),$("#btnShowListMovies").click((function(){g("#btnShowListMovies"),L("#sectionListMovies"),u()})),$("#btnShowAbout").click((function(){g("#btnShowAbout"),L("#sectionAbout"),u()})),$("#filmStateFlag").on({error:function(){$(this).hide()},load:function(){$(this).show()}}),l=function(){$("#filmCount").text(a.length),c(),f("#listStates",a,e.STATE),f("#listMovies",s,e.TITLE),function(){let e={};a.forEach((function(t){var o=t.year.toString().slice(0,3)+"0s";e[o]=(e[o]||0)+1}));const o=Object.keys(e).sort(),i=o.map(t=>e[t]);let n=$("#byDecade");new Chart(n,{type:"bar",options:{plugins:{legend:{display:!1}},borderWidth:1,scales:{x:{grid:{color:"#505050"},ticks:{color:"#a0a0a0"}},y:{grid:{color:"#505050"},ticks:{color:"#a0a0a0"}}}},data:{labels:o,datasets:[{label:"Total",fill:!0,data:i,backgroundColor:t.slice(0,o.length),borderColor:"#a0a0a0",borderWidth:1}]}})}(),s.filter(t=>t.title.indexOf(t.state)>-1).forEach(t=>$("#stateInTitle").append(T(t,e.TITLE))),function(){let t=s.slice().sortBy(o.YEAR);$("#oldestNewest").append(T(t.shift(),e.TITLE),T(t.pop(),e.TITLE))}(),function(){let t=s.slice().sortBy(o.TITLE_LENGTH);$("#longestShortest").append(T(t.shift(),e.TITLE),T(t.pop(),e.TITLE))}()},a=[],s=[],r={},$.getJSON("data/films.json",(function(e){e.forEach((function(e){e.colour=function(){let e=Math.floor(Math.random()*t.length);return t[e]}(),r[e.stateCode]=e})),a=e.sortBy(o.STATE),s=e.slice().sortBy(o.TITLE),l()})),String.prototype.sortable=function(){return this.replace(/^(A|The) /,"")},Array.prototype.sortBy=function(t){return this.sort((function(e,o){return t(e)<t(o)?-1:t(e)>t(o)?1:0}))}}));